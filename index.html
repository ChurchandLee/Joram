<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartoListen - AI Mental Health Support</title>
    <link rel="manifest" href="manifest.json">
    <meta name="description" content="Free AI-powered mental health support chat. A safe, judgment-free space for mental wellness.">
    <meta name="theme-color" content="#2E8B57">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#4ade80">

    <!-- Apple-specific meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Hear to Listen">

    <!-- Apple touch icons -->
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">

    <!-- Microsoft tiles -->
    <meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#4ade80">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2E8B57 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 700px;
        }

        .logo-header {
            background: linear-gradient(135deg, #8BC34A 0%, #4CAF50 100%);
            padding: 25px;
            text-align: center;
            color: white;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px auto;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo-header p {
            opacity: 0.95;
            font-size: 1.1em;
            font-weight: 500;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        }

        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease-out;
            line-height: 1.6;
            font-size: 15px;
        }

        .ai-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            color: #2c3e50;
            align-self: flex-start;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .user-message {
            background: linear-gradient(135deg, #2E8B57 0%, #45a049 100%);
            color: white;
            align-self: flex-end;
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.3);
        }

        .input-area {
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        .input-field:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .send-button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .send-button:active {
            transform: translateY(0);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 18px;
            margin-top: 10px;
            border-left: 4px solid #4CAF50;
        }

        .typing-dots {
            display: flex;
            gap: 5px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: typing 1.4s infinite;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        .welcome-section {
            text-align: center;
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(139, 195, 74, 0.08) 100%);
            border-radius: 15px;
            border: 2px dashed rgba(76, 175, 80, 0.2);
        }

        .welcome-section h2 {
            color: #2E8B57;
            font-size: 1.4em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .welcome-section p {
            color: #5a6c57;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .crisis-resources {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 2px solid #81c784;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .crisis-resources h3 {
            color: #2E8B57;
            margin-bottom: 15px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .crisis-info {
            display: grid;
            gap: 8px;
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .crisis-info strong {
            color: #2E8B57;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .quick-action {
            padding: 10px 16px;
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            color: #2E8B57;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .quick-action:hover {
            background: rgba(76, 175, 80, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        .disclaimer {
            background: linear-gradient(135deg, #fff8dc 0%, #ffeaa7 100%);
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
            color: #8b4513;
            text-align: center;
            font-weight: 500;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        /* Responsive design */
        @media (max-width: 600px) {
            .container {
                height: 90vh;
                margin: 10px;
            }
            
            .logo {
                width: 100px;
                height: 100px;
            }
            
            .logo-header h1 {
                font-size: 1.8em;
            }
            
            .message {
                max-width: 95%;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .quick-action {
                width: 100%;
                max-width: 250px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo Header Section -->
        <div class="logo-header">
            <img src="heartolisten-logo.png.png" alt="HeartoListen Logo" class="logo">
            <h1>HeartoListen</h1>
            <p>AI Mental Health Support - Self Discovery for Positive Mental Health</p>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <!-- Welcome Message -->
            <div class="welcome-section">
                <h2>Welcome to Hear to Listen ðŸŒ¿</h2>
                <p>I'm here to listen and support you through whatever you're experiencing. This is a safe, judgment-free space where you can share your thoughts and feelings.</p>
                
                <!-- Important Disclaimer -->
                <div class="disclaimer">
                    <strong>Important:</strong> This is an AI tool for support and guidance. In case of crisis or emergency, please contact professional help immediately.
                </div>

                <!-- Crisis Resources -->
                <div class="crisis-resources">
                    <h3>ðŸ†˜ Crisis Resources</h3>
                    <div class="crisis-info">
                        <div><strong>US:</strong> 988 (Suicide & Crisis Lifeline) | Text HOME to 741741</div>
                        <div><strong>UK:</strong> 116 123 (Samaritans) | Text SHOUT to 85258</div>
                        <div><strong>Emergency:</strong> 911 (US) | 999 (UK)</div>
                    </div>
                </div>

                <!-- Quick Action Buttons -->
                <div class="quick-actions">
                    <div class="quick-action" onclick="sendQuickMessage('I\'m feeling anxious')">I'm feeling anxious</div>
                    <div class="quick-action" onclick="sendQuickMessage('Need motivation')">Need motivation</div>
                    <div class="quick-action" onclick="sendQuickMessage('Sleep troubles')">Sleep troubles</div>
                    <div class="quick-action" onclick="sendQuickMessage('Feeling overwhelmed')">Feeling overwhelmed</div>
                </div>
            </div>

            <!-- AI Initial Message -->
            <div class="message ai-message">
                Hello! I'm your Hear to Listen companion. I'm here to provide a safe space for you to share your thoughts and feelings. How are you doing today?
            </div>

            <!-- Typing Indicator -->
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <input type="text" 
                   id="messageInput" 
                   class="input-field" 
                   placeholder="Share what's on your mind..." 
                   onkeypress="handleKeyPress(event)">
            <button id="sendButton" class="send-button" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // AI Mental Health Companion System Prompt
        const SYSTEM_PROMPT = `You are an AI mental health companion whose primary role is to listen with empathy, patience, and genuine warmth. Your style is calm, validating, and encouraging, without judgment or criticism. You never give direct medical advice, diagnose conditions, or prescribe treatment. Instead, you:
        - Reflect back what the user has said so they feel understood.
        - Offer new perspectives gently, never forcefully.
        - Suggest practical grounding techniques or coping strategies when appropriate.
        - Recognise and acknowledge the user's emotions without dismissing or minimising them.
        - Use plain, conversational language, avoiding clinical jargon.
        - Where relevant, help the user reframe challenges in a hopeful, realistic way.

        You watch for potential signs of crisis or harm to self/others, and in such cases, you:
        - Respond with heightened compassion.
        - Gently recommend the user seek immediate help from a trained mental health professional or helpline.
        - Provide relevant helpline numbers for their region if possible.

        Tone guide:
        - Always sound human and present.
        - Use short paragraphs for readability.
        - Ask gentle, open-ended questions to encourage reflection.
        - Never overwhelm the user with too much information at once.
        - Prioritise emotional safety over problem-solving.

        Your goal: Make the user feel heard, valued, and a little more hopeful at the end of each exchange.`;

        // Chat functionality
        let conversationHistory = [];

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate AI response (in a real app, this would be an API call)
            setTimeout(() => {
                hideTypingIndicator();
                generateAIResponse(message);
            }, 1500 + Math.random() * 1000); // Random delay between 1.5-2.5 seconds
        }

        function sendQuickMessage(message) {
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        function addMessage(content, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.textContent = content;
            
            // Remove welcome section after first user message
            if (sender === 'user') {
                const welcomeSection = document.querySelector('.welcome-section');
                if (welcomeSection) {
                    welcomeSection.remove();
                }
            }
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            // Store in conversation history
            conversationHistory.push({
                role: sender === 'user' ? 'user' : 'assistant',
                content: content
            });
        }

        function generateAIResponse(userMessage) {
            // This is a simplified response system. In a real app, you would:
            // 1. Send the conversation history + system prompt to OpenAI API
            // 2. Get the response and display it
            // 3. Handle error cases and crisis detection
            
            const responses = getContextualResponse(userMessage);
            const response = responses[Math.floor(Math.random() * responses.length)];
            
            addMessage(response, 'ai');
        }

        function getContextualResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Crisis keywords - in a real app, this would be more sophisticated
            const crisisKeywords = ['suicide', 'kill myself', 'end it all', 'hurt myself', 'self harm'];
            const isCrisis = crisisKeywords.some(keyword => lowerMessage.includes(keyword));
            
            if (isCrisis) {
                return [
                    "I'm really concerned about what you're sharing, and I want you to know that your feelings are valid and you're not alone. Please reach out to a crisis helpline right away - they have trained professionals who can provide immediate support. In the US, you can call 988 or text HOME to 741741. Your life has value, and there are people who want to help.",
                    "What you're feeling right now sounds incredibly difficult, and I'm worried about your safety. Please contact emergency services or a crisis helpline immediately. You deserve professional support right now. In the UK, Samaritans (116 123) are available 24/7. Please don't go through this alone."
                ];
            }
            
            // Anxiety responses
            if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('worried')) {
                return [
                    "I can hear that you're feeling anxious right now. That must feel really overwhelming. Sometimes when anxiety hits, it can help to focus on your breathing - try breathing in for 4 counts, holding for 4, and out for 6. What's been on your mind that's contributing to these anxious feelings?",
                    "Anxiety can feel so intense and consuming. I want you to know that what you're experiencing is valid. One thing that sometimes helps is the 5-4-3-2-1 grounding technique - name 5 things you can see, 4 you can touch, 3 you can hear, 2 you can smell, and 1 you can taste. Would you like to talk about what's triggering these anxious feelings?",
                    "It sounds like anxiety is really weighing on you right now. That's such a difficult feeling to carry. Your mind might be racing with 'what ifs' - that's what anxiety does. Remember that anxious thoughts aren't facts. What would feel most supportive for you right now?"
                ];
            }
            
            // Depression/sadness responses
            if (lowerMessage.includes('depressed') || lowerMessage.includes('sad') || lowerMessage.includes('hopeless')) {
                return [
                    "I can sense the heaviness in what you're sharing, and I want you to know that I'm here with you in this difficult moment. Depression can make everything feel so much harder. You're brave for reaching out and talking about this. What's been the most challenging part of what you're going through?",
                    "It takes courage to share when you're feeling this low. Depression can make us feel so isolated and like nothing will ever get better, but you're not alone in this. These feelings, as painful as they are, can change. What's one small thing that used to bring you even a tiny bit of comfort?",
                    "Thank you for trusting me with how you're feeling. When we're depressed, it's like looking at the world through dark-tinted glasses - everything seems harder and more hopeless. But you're still here, still reaching out, and that matters. How long have you been carrying these heavy feelings?"
                ];
            }
            
            // Sleep issues
            if (lowerMessage.includes('sleep') || lowerMessage.includes('insomnia') || lowerMessage.includes('tired')) {
                return [
                    "Sleep troubles can affect everything - your mood, energy, and ability to cope with stress. It's frustrating when you need rest but can't seem to get it. What's your sleep routine like? Sometimes creating a calming pre-sleep ritual can help signal to your body that it's time to wind down.",
                    "Not getting good sleep makes everything feel more difficult, doesn't it? Your mind and body need that rest to recharge. Are there things on your mind that keep you awake, or is it more physical restlessness? Sometimes talking through what's keeping us up can help.",
                    "Sleep issues are so draining, both physically and emotionally. It's like being tired but wired at the same time. Have you noticed if there are particular thoughts or worries that surface when you're trying to sleep?"
                ];
            }
            
            // Overwhelmed responses
            if (lowerMessage.includes('overwhelmed') || lowerMessage.includes('too much') || lowerMessage.includes('stressed')) {
                return [
                    "Feeling overwhelmed is like being caught in a storm - everything feels too much at once. It's completely understandable that you're feeling this way. Sometimes when we're overwhelmed, it can help to pick just one small thing to focus on. What feels most pressing or urgent to you right now?",
                    "When everything feels like too much, it's natural to feel overwhelmed. Your feelings make complete sense. Sometimes it helps to remember that you don't have to solve everything at once. What would it look like to take things one step at a time?",
                    "That sense of being overwhelmed is so heavy to carry. It's like having too many browser tabs open in your mind. You're dealing with a lot, and it's okay to feel like it's too much sometimes. What's been the biggest source of stress for you lately?"
                ];
            }
            
            // Motivation responses
            if (lowerMessage.includes('motivation') || lowerMessage.includes('motivated') || lowerMessage.includes('stuck')) {
                return [
                    "It sounds like you're looking for that spark to get moving again. Sometimes motivation feels elusive, especially when we're going through tough times. What's something small that you accomplished recently, even if it seemed minor? Sometimes acknowledging the little things can help us find momentum.",
                    "Feeling unmotivated can be so frustrating, especially when you know there are things you want or need to do. Sometimes motivation follows action, rather than the other way around. What's one tiny step you could take today, even if you don't feel like it?",
                    "I hear that you're struggling with motivation right now. That's actually really common, and it doesn't mean anything is wrong with you. What usually helps you feel more energized or purposeful? Even if those things don't feel appealing right now, they might give us clues about what could help."
                ];
            }
            
            // General supportive responses
            return [
                "Thank you for sharing that with me. I can hear that you're going through something difficult right now. Your feelings are completely valid, and I'm glad you felt comfortable opening up. What would feel most helpful for you in this moment?",
                "I'm really glad you reached out to talk about this. It takes strength to share what's on your mind, especially when things feel heavy. I'm here to listen and support you through whatever you're experiencing. How are you taking care of yourself right now?",
                "I can sense that there's a lot on your mind. Thank you for trusting me with your thoughts and feelings. You don't have to carry everything alone. What's been the most challenging part of your day or week?",
                "It sounds like you're dealing with quite a bit right now. I want you to know that your feelings matter, and it's completely okay to not be okay sometimes. What kind of support feels most helpful to you?",
                "I appreciate you sharing what's going on for you. Sometimes just putting our thoughts into words can provide a little relief. I'm here to listen without judgment and walk alongside you through whatever you're facing. What's weighing most heavily on your heart?"
            ];
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'flex';
            const chatArea = document.getElementById('chatArea');
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Focus on input field when page loads
            document.getElementById('messageInput').focus();
            
            // Add some initial context to conversation history
            conversationHistory.push({
                role: 'system',
                content: SYSTEM_PROMPT
            });
        });

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed');
                    });
            });
        }
    </script>
</body>
</html>
