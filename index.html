<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartoListen - AI Mental Health Support</title>
    <meta name="description" content="Free AI-powered mental health support chat. A safe, judgement-free space for mental wellness.">
    <meta name="theme-color" content="#8eaf78">
    
    <!-- PWA and App Icon Meta Tags -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/heartolisten-logo.png.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/heartolisten-logo.png.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/heartolisten-logo.png.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS specific -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HeartoListen">
    
    <!-- Android specific -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #8eaf78 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-image: url('https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/fern background.png');
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 700px;
        }

        .logo-header {
            background: linear-gradient(135deg, #5f795a 0%, #4CAF50 100%);
            padding: 25px;
            text-align: center;
            color: white;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            width: 150px;
            height: 150px;
            margin: 0 auto 15px auto;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo-header p {
            opacity: 0.95;
            font-size: 1.1em;
            font-weight: 500;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        }

        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease-out;
            line-height: 1.6;
            font-size: 15px;
            white-space: pre-wrap;
        }

        .ai-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            color: #274e13;
            align-self: flex-start;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 15px 20px;
        }

        .ai-message-content {
            flex: 1;
            line-height: 1.6;
        }

        .ai-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(76, 175, 80, 0.3);
            object-fit: cover;
            object-position: center;
            flex-shrink: 0;
        }

        .user-message {
            background: linear-gradient(135deg, #8eaf78 0%, #45a049 100%);
            color: white;
            align-self: flex-end;
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.3);
        }

        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            color: #c62828;
            align-self: flex-start;
            border-left: 4px solid #f44336;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .thinking-heart {
            font-size: 24px;
            animation: heartPulse 1.5s ease-in-out infinite;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .welcome-section {
            text-align: center;
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(139, 195, 74, 0.08) 100%);
            border-radius: 15px;
            border: 2px dashed rgba(76, 175, 80, 0.2);
        }

        .welcome-section h2 {
            color: #8eaf78;
            font-size: 1.4em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .welcome-section p {
            color: #5a6c57;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .disclaimer {
            background: linear-gradient(135deg, #fff8dc 0%, #ffeaa7 100%);
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
            color: #8b4513;
            text-align: center;
            font-weight: 500;
        }

        .input-area {
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        .input-field:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .send-button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .send-button:active {
            transform: translateY(0);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes heartPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.3);
                opacity: 1;
            }
        }

        /* Responsive design */
        @media (max-width: 600px) {
            .container {
                height: 90vh;
                margin: 10px;
            }
            
            .logo {
                width: 120px;
                height: 120px;
            }
            
            .logo-header h1 {
                font-size: 1.8em;
            }
            
            .message {
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo Header Section -->
        <div class="logo-header">
            <div class="logo">
                <img src="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/heartolisten-logo.png.png" alt="HeartoListen Logo" style="width: 100%; height: 100%; object-fit: contain;">
            </div>   
            <h1>HeartoListen</h1>
            <p>AI Mental Health Support - Self Discovery for Positive Mental Health</p>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <!-- Welcome Message -->
            <div class="welcome-section">
                <h2>Welcome to Hear to Listen</h2>
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0;">
                    <img src="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/Eden.png" alt="Eden Avatar" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid rgba(76, 175, 80, 0.3); object-fit: cover; object-position: center;">
                    <p style="margin: 0;">I'm Eden and I am here to listen and support you through whatever you're experiencing. This is a safe, judgement-free space where you can share your thoughts and feelings.</p>
                </div>
                
                <!-- Important Disclaimer -->
                <div class="disclaimer">
                    <strong>Important:</strong> This is an AI tool for support and guidance. In case of CRISIS or EMERGENCY, please contact professional help IMMEDIATELY. UK: 999 USA: 911 (or your national Emergency phone number)
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <input type="text" 
                   id="messageInput" 
                   class="input-field" 
                   placeholder="Share what's on your mind..." 
                   onkeypress="handleKeyPress(event)">
            <button id="sendButton" class="send-button" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // OpenAI API Configuration
        const OPENAI_API_KEY = 'YOUR_API_KEY_HERE';

        // Enhanced Mental Health System Prompt for ChatGPT
        const SYSTEM_PROMPT = `You are a compassionate AI mental health companion named "Eden" from HeartoListen. Your primary role is to provide supportive, exploratory conversations that help people process their feelings and thoughts.`;

        // Chat functionality
        let conversationHistory = [{
            role: 'system',
            content: SYSTEM_PROMPT
        }];

        // Track used responses to prevent repetition
        let usedResponses = {
            suicidal: [], scared: [], worried: [], anxiety: [], depression: [], loneliness: [], 
            overwhelmed: [], anger: [], motivation: [], sleep_troubles: [], greeting: [], general: []
        };

        // Comprehensive Mental Health Response System
        function generateIntelligentResponse(userMessage, conversationHistory = []) {
            const responses = {
                // CRISIS/SUICIDAL IDEATION - ONLY for explicit crisis situations
                suicidal: [
                    "I'm really concerned about what you've shared with me about wanting to end your life. This sounds like you're in serious emotional pain right now. Your safety is the most important thing, and there are people specifically trained to help with these feelings:\n\nâ€¢ US: 988 (Suicide & Crisis Lifeline) - 24/7\nâ€¢ UK: 116 123 (Samaritans) - 24/7\nâ€¢ Crisis Text: HOME to 741741\n\nAre you in immediate danger right now? Can you stay safe while we talk about getting you connected with crisis support?"
                ],

                // Scared - Specific responses for fear
                scared: [
                    "I can hear that you're feeling really scared right now. Fear can be such an overwhelming emotion, especially when it feels big and consuming. What's frightening you most at the moment? Sometimes naming our fears can help us understand them better and figure out what might help you feel safer.",
                    "It sounds like fear is really present for you right now. That must feel so unsettling and exhausting. What does this scared feeling look like for you - is it more about something specific that might happen, or is it a more general sense of unease? I'm here to listen and explore this with you."
                ],

                // Worried - Specific responses for worry
                worried: [
                    "I can sense that worry is taking up a lot of space in your mind right now. Worry can be so persistent and draining. What are you finding yourself most worried about? Sometimes when we name our worries out loud, it can help us see which ones we might have some control over and which ones we don't.",
                    "It sounds like your mind is doing a lot of worrying right now. That mental energy can be exhausting. What kinds of 'what if' scenarios is your mind creating? Are these worries about things happening soon, or more long-term concerns? I'm curious about what's driving this worried feeling for you."
                ],

                // Anxiety - Understanding and exploring
                anxiety: [
                    "I can hear that anxiety is really present for you right now. What does your anxiety typically feel like - is it more physical sensations, racing thoughts, or that constant sense of dread? I'm curious about what kinds of situations or thoughts tend to trigger it most for you. What's been on your mind that's making the anxiety feel particularly present right now?",
                    "When you mention feeling anxious, I wonder what that experience is like for you. Does it come in waves, or is it more of a constant background hum? What thoughts tend to fuel it most? Sometimes exploring what our anxiety is trying to tell us can be helpful - what do you think yours might be worried about?"
                ],

                // Depression - Deeper exploration
                depression: [
                    "Depression can feel like such a heavy, persistent presence. When you think about your depression, what does it feel like in your daily life right now? I'm curious - is this a recent struggle, or something you've been dealing with for a while? What made you want to talk about it today?",
                    "You mentioned feeling depressed, and I wonder what that looks like for you specifically. Is it more of a numbness, a heavy sadness, or that exhausting fog that makes everything feel difficult? What time of day tends to be hardest, and have you noticed anything that makes it slightly better or worse?"
                ],

                // Loneliness - Compassionate exploration
                loneliness: [
                    "Loneliness can feel so isolating, especially when it seems like everyone else is naturally connected. What does loneliness feel like for you right now? Is it missing specific people, or more about wanting someone who really understands you? I'm curious about what kind of connection you're most longing for.",
                    "When you say you're feeling lonely, I wonder what that looks like in your daily life. Are you physically alone a lot, or is it more that feeling of being surrounded by people but still feeling unseen? What would meaningful connection look like for you - what are you hoping to find in relationships that feels missing right now?"
                ],

                // Overwhelmed - Practical exploration
                overwhelmed: [
                    "When everything feels like too much, it can be hard to even know where to start. What's contributing most to feeling overwhelmed right now - is it work, relationships, life changes, or just an accumulation of daily stresses? Sometimes talking through what's on your plate can help us see patterns or priorities.",
                    "That overwhelmed feeling can be so paralyzing. What does your typical day look like right now? When you think about everything you're dealing with, what feels most urgent versus what might actually be most important? Sometimes those are different things, and sorting that out can help reduce the pressure."
                ],

                // Anger
                anger: [
                    "I can sense there's some real anger present for you right now. Anger can be such a powerful emotion - what's been triggering it for you lately? Sometimes anger is telling us something important about our boundaries or what matters to us. What do you think might be underneath this anger you're feeling?",
                    "It sounds like anger is taking up space in your life right now. What does that anger feel like when it shows up - is it quick and intense, or more of a simmering frustration? I'm curious about what situations or thoughts tend to spark it most for you. What's been most frustrating lately?"
                ],

                // Motivation - Curiosity about what's underneath
                motivation: [
                    "Lack of motivation can be so frustrating, especially when you know what you 'should' be doing but just can't seem to make yourself do it. What's that experience like for you right now? Are there specific things you're struggling to motivate yourself for, or is it more of a general feeling? Sometimes understanding what's underneath can help.",
                    "When motivation feels absent, it's worth exploring what might be going on underneath. Is it that the goals don't feel meaningful anymore, or are you feeling overwhelmed, or maybe burned out? What used to motivate you that doesn't seem to work anymore? Sometimes our motivation systems need recalibrating."
                ],

                // Sleep troubles
                sleep_troubles: [
                    "Sleep troubles can affect everything else in your life. What's your sleep situation like right now - is it trouble falling asleep, staying asleep, or waking up feeling unrefreshed? When did you first notice these sleep issues starting? Sometimes there are patterns or triggers we can identify.",
                    "Poor sleep can create such a frustrating cycle where you're tired but wired, or exhausted but your mind won't turn off. What goes through your mind when you're lying there unable to sleep? Are there particular worries or thoughts that tend to keep you up, or is it more physical restlessness?"
                ],

                // Greeting - Warm and curious
                greeting: [
                    "Hello! I'm really glad you're here. This is your space to share whatever's truly on your mind. What brought you here today? Whether it's something specific weighing on you or you're just feeling a bit off and not sure why, I'm here to listen and explore it with you.",
                    "Hi there! Thank you for reaching out. I'm curious about what's happening in your world right now. What's been occupying your thoughts lately, or what made you want to talk to someone today? Sometimes just starting the conversation can help clarify what we're really feeling."
                ],

                // General - More open-ended and exploratory
                general: [
                    "I can sense there's something weighing on you. What's been occupying your thoughts lately? Sometimes just having space to talk through what's on our minds can help us process things better. What feels most important for you to share right now?",
                    "It sounds like you're going through something. What's your inner world like at the moment? I'm genuinely curious about your experience and what's been feeling most challenging or confusing for you lately. What would feel helpful to explore together?",
                    "I hear that you're reaching out, and I want you to know that whatever you're experiencing matters. What's been going on that made you want to talk today? What feels most present or pressing in your life right now?",
                    "Thank you for trusting me with whatever you're carrying. What's been on your heart or mind recently? Sometimes we know exactly what we want to talk about, and sometimes we just need space to figure it out. Either way is completely fine - where would you like to start?",
                    "I can tell there's something you want to share. What's been the most challenging part of your day, week, or even just this moment? I'm here to listen and explore whatever feels most important to you right now.",
                    "What's been taking up the most emotional space for you lately? Sometimes naming what we're feeling or going through can help us understand it better. I'm curious about your unique experience and what support might feel most helpful.",
                    "I sense you have something on your mind that you're trying to work through. What would it feel like to share what's really going on underneath the surface? What's been the hardest thing for you to carry recently?",
                    "It takes courage to reach out when we're struggling with something. What made you want to talk today? What's been happening in your life that feels important to process or understand better?",
                    "What's your emotional landscape looking like right now? Are you feeling stuck with something, overwhelmed, or maybe just needing someone to listen? I'm genuinely interested in understanding what you're going through.",
                    "I'm really glad you're here. What's been weighing most heavily on your mind or heart lately? Sometimes just having someone to talk through our thoughts and feelings with can help us see things more clearly."
                ]
            };

            const lowerMessage = userMessage.toLowerCase();
            let responseCategory = 'general';
            
            // Detection logic - Comprehensive keyword detection
            if (lowerMessage.includes('suicidal') || lowerMessage.includes('kill myself') || lowerMessage.includes('want to die') || lowerMessage.includes('end my life') || lowerMessage.includes('suicide') || lowerMessage.includes('self harm') || lowerMessage.includes('hurt myself')) {
                responseCategory = 'suicidal';
            }
            else if (lowerMessage.includes('scared') || lowerMessage.includes('afraid') || lowerMessage.includes('frightened') || lowerMessage.includes('fear')) {
                responseCategory = 'scared';
            }
            else if (lowerMessage.includes('worried') || lowerMessage.includes('worrying') || lowerMessage.includes('worry')) {
                responseCategory = 'worried';
            }
            else if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('panic') || lowerMessage.includes('nervous')) {
                responseCategory = 'anxiety';
            }
            else if (lowerMessage.includes('depressed') || lowerMessage.includes('depression') || lowerMessage.includes('sad') || lowerMessage.includes('hopeless') || lowerMessage.includes('down') || lowerMessage.includes('low')) {
                responseCategory = 'depression';
            }
            else if (lowerMessage.includes('lonely') || lowerMessage.includes('loneliness') || lowerMessage.includes('alone') || lowerMessage.includes('isolated')) {
                responseCategory = 'loneliness';
            }
            else if (lowerMessage.includes('overwhelmed') || lowerMessage.includes('too much') || lowerMessage.includes('burnout') || lowerMessage.includes('stressed')) {
                responseCategory = 'overwhelmed';
            }
            else if (lowerMessage.includes('angry') || lowerMessage.includes('anger') || lowerMessage.includes('furious') || lowerMessage.includes('rage') || lowerMessage.includes('mad')) {
                responseCategory = 'anger';
            }
            else if (lowerMessage.includes('motivation') || lowerMessage.includes('need motivation') || lowerMessage.includes('unmotivated') || lowerMessage.includes('no energy')) {
                responseCategory = 'motivation';
            }
            else if (lowerMessage.includes('sleep') || lowerMessage.includes('insomnia') || lowerMessage.includes('can\'t sleep') || lowerMessage.includes('sleep troubles') || lowerMessage.includes('tired')) {
                responseCategory = 'sleep_troubles';
            }
            else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                responseCategory = 'greeting';
            }
            
            // Get response from category, avoiding repetition
            const categoryResponses = responses[responseCategory] || responses['general'];
            const usedCategoryResponses = usedResponses[responseCategory] || [];
            
            // Find unused responses
            const unusedResponses = categoryResponses.filter(response => 
                !usedCategoryResponses.includes(response)
            );
            
            let selectedResponse;
            if (unusedResponses.length > 0) {
                selectedResponse = unusedResponses[Math.floor(Math.random() * unusedResponses.length)];
            } else {
                // All responses used, reset and pick one
                usedResponses[responseCategory] = [];
                selectedResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            }
            
            // Track this response as used
            if (!usedResponses[responseCategory]) {
                usedResponses[responseCategory] = [];
            }
            usedResponses[responseCategory].push(selectedResponse);
            
            return { choices: [{ message: { content: selectedResponse } }] };
        }

        // ChatGPT API call function with fallback
        async function callChatGPT(messages) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENAI_API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: "gpt-4",
                        messages: messages,
                        temperature: 0.75,
                        top_p: 0.9,
                        max_tokens: 800,
                        frequency_penalty: 0.3,
                        presence_penalty: 0.1,
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('OpenAI API Error:', error);
                // Fall back to intelligent response system
                const lastUserMessage = messages[messages.length - 1].content;
                return generateIntelligentResponse(lastUserMessage, messages);
            }
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Disable send button and input
            sendButton.disabled = true;
            input.disabled = true;
            
            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Add user message to conversation history
                conversationHistory.push({
                    role: 'user',
                    content: message
                });

                // Call ChatGPT API with intelligent fallback
                const data = await callChatGPT(conversationHistory);
                const aiResponse = data.choices[0].message.content.trim();
                
                // Add AI response to conversation history
                conversationHistory.push({
                    role: 'assistant',
                    content: aiResponse
                });

                // Keep conversation history manageable
                if (conversationHistory.length > 21) {
                    conversationHistory = [
                        conversationHistory[0], // Keep system prompt
                        ...conversationHistory.slice(-20) // Keep last 20 messages
                    ];
                }

                hideTypingIndicator();
                addMessage(aiResponse, 'ai');

            } catch (error) {
                hideTypingIndicator();
                console.error('Error:', error);
                
                // Fallback to intelligent response
                const fallbackResponse = generateIntelligentResponse(message, conversationHistory);
                addMessage(fallbackResponse.choices[0].message.content, 'ai');
            } finally {
                // Re-enable send button and input
                sendButton.disabled = false;
                input.disabled = false;
                input.focus();
            }
        }

        function addMessage(content, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            if (sender === 'ai') {
                // Create AI message with avatar
                messageDiv.innerHTML = `
                    <img src="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/Eden.png" alt="Eden Avatar" class="ai-avatar">
                    <div class="ai-message-content">${content}</div>
                `;
            } else {
                // Regular user message
                messageDiv.textContent = content;
            }
            
            // Remove welcome section after first user message
            if (sender === 'user') {
                const welcomeSection = document.querySelector('.welcome-section');
                if (welcomeSection) {
                    welcomeSection.remove();
                }
            }
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            // Remove any existing typing indicator first
            hideTypingIndicator();
            
            // Create a new typing indicator
            const chatArea = document.getElementById('chatArea');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message';
            typingDiv.id = 'currentTypingIndicator';
            typingDiv.innerHTML = `
                <img src="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/Eden.png" alt="Eden Avatar" class="ai-avatar">
                <div class="thinking-heart">ðŸ’š</div>
            `;
            
            chatArea.appendChild(typingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTypingIndicator() {
            const existingIndicator = document.getElementById('currentTypingIndicator');
            if (existingIndicator) {
                existingIndicator.remove();
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
