<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HeartoListen - AI Mental Health Support</title>
    <meta name="description" content="Free AI-powered mental health support chat. A safe, judgement-free space for mental wellness.">
    <meta name="theme-color" content="#8eaf78">
    
    <!-- PWA and App Icon Meta Tags -->
    <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/heartolisten-logo.png.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/heartolisten-logo.png.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/heartolisten-logo.png.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS specific -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HeartoListen">
    
    <!-- Android specific -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #8eaf78 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background-image: url('https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/fern background.png');
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 700px;
        }

        .logo-header {
            background: linear-gradient(135deg, #5f795a 0%, #4CAF50 100%);
            padding: 25px;
            text-align: center;
            color: white;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px auto;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo-header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo-header p {
            opacity: 0.95;
            font-size: 1.1em;
            font-weight: 500;
        }

        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        }

        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease-out;
            line-height: 1.6;
            font-size: 15px;
            white-space: pre-wrap;
        }

        .ai-message {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
            color: #274e13;
            align-self: flex-start;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 15px 20px;
        }

        .ai-message-content {
            flex: 1;
            line-height: 1.6;
        }

        .ai-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(76, 175, 80, 0.3);
            object-fit: cover;
            object-position: center;
            flex-shrink: 0;
        }

        .user-message {
            background: linear-gradient(135deg, #8eaf78 0%, #45a049 100%);
            color: white;
            align-self: flex-end;
            box-shadow: 0 4px 12px rgba(46, 139, 87, 0.3);
        }

        .error-message {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            color: #c62828;
            align-self: flex-start;
            border-left: 4px solid #f44336;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .thinking-heart {
            font-size: 24px;
            animation: heartPulse 1.5s ease-in-out infinite;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .welcome-section {
            text-align: center;
            margin: 20px 0;
            padding: 25px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.08) 0%, rgba(139, 195, 74, 0.08) 100%);
            border-radius: 15px;
            border: 2px dashed rgba(76, 175, 80, 0.2);
        }

        .welcome-section h2 {
            color: #8eaf78;
            font-size: 1.4em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .welcome-section p {
            color: #5a6c57;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .disclaimer {
            background: linear-gradient(135deg, #fff8dc 0%, #ffeaa7 100%);
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
            color: #8b4513;
            text-align: center;
            font-weight: 500;
        }

        .input-area {
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        .input-field:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .send-button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }

        .send-button:active {
            transform: translateY(0);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes heartPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.8;
            }
            50% {
                transform: scale(1.3);
                opacity: 1;
            }
        }

        /* Responsive design */
        @media (max-width: 600px) {
            .container {
                height: 90vh;
                margin: 10px;
            }
            
            .logo {
                width: 100px;
                height: 100px;
            }
            
            .logo-header h1 {
                font-size: 1.8em;
            }
            
            .message {
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo Header Section -->
        <div class="logo-header">
 <div class="logo">
    <img src="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/heartolisten-logo.png.png" alt="HeartoListen Logo" style="width: 100%; height: 100%; object-fit: contain;">
</div>   
            <h1>HeartoListen</h1>
            <p>AI Mental Health Support - Self Discovery for Positive Mental Health</p>
        </div>

        <!-- Chat Area -->
        <div class="chat-area" id="chatArea">
            <!-- Welcome Message -->
            <div class="welcome-section">
                <h2>Welcome to Hear to Listen</h2>
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0;">
                    <img src="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/Eden.png" alt="Eden Avatar" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid rgba(76, 175, 80, 0.3); object-fit: cover; object-position: center;">
                    <p style="margin: 0;">I'm Eden and I am here to listen and support you through whatever you're experiencing. This is a safe, judgement-free space where you can share your thoughts and feelings.</p>
                </div>
                
                <!-- Important Disclaimer -->
                <div class="disclaimer">
                    <strong>Important:</strong> This is an AI tool for support and guidance. In case of CRISIS or EMERGENCY, please contact professional help IMMEDIATELY. UK: 999 USA: 911 (or your national Emergency phone number)
                </div>
            </div>
        </div>

        <!-- Input Area - MOVED TO BOTTOM -->
        <div class="input-area">
            <input type="text" 
                   id="messageInput" 
                   class="input-field" 
                   placeholder="Share what's on your mind..." 
                   onkeypress="handleKeyPress(event)">
            <button id="sendButton" class="send-button" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // OpenAI API Configuration
        const OPENAI_API_KEY = 'YOUR_API_KEY_HERE';

        // Enhanced Mental Health System Prompt for ChatGPT
        const SYSTEM_PROMPT = `You are a compassionate AI mental health companion named "HeartoListen". Your primary role is to provide supportive, exploratory conversations that help people process their feelings and thoughts. Your responses should be:

CONVERSATION STYLE:
- Engage in supportive, exploratory dialogue rather than giving immediate advice
- Ask thoughtful, open-ended questions that encourage deeper reflection
- Explore what the person is sharing - dig deeper into their experience
- Show genuine curiosity about their situation and feelings
- Offer gentle suggestions and coping strategies when appropriate
- Help them explore their own thoughts and find their own insights

TONE & APPROACH:
- Warm, validating, and encouraging without being clinical
- Use conversational, natural language that feels like talking to a caring friend
- Vary your language significantly - never repeat the same phrases or sentence structures
- Be genuinely curious about their experience and ask follow-up questions
- Focus on understanding their unique situation rather than giving generic responses

KEY PRINCIPLES:
- EXPLORE their feelings and experiences through thoughtful questions
- VALIDATE what they're going through without immediately problem-solving
- ENCOURAGE self-reflection and deeper exploration of their thoughts
- OFFER practical suggestions only when they seem ready or ask for them
- AVOID repetitive empathy phrases - be genuinely curious instead
- ONLY suggest professional help for crisis situations (suicide, self-harm, immediate danger)

CRISIS RESPONSE (ONLY for suicidal ideation or immediate danger):
If you detect explicit mentions of suicide, self-harm, or immediate danger:
- Respond with concern and provide crisis resources
- US: 988 (Suicide & Crisis Lifeline), UK: 116 123 (Samaritans)
- Text HOME to 741741 for crisis text support

CONVERSATION FLOW:
- Ask specific questions about their situation
- Explore the context and background of what they're experiencing
- Help them identify patterns, triggers, or underlying factors
- Encourage them to reflect on their own coping strategies and strengths
- Offer gentle suggestions for self-care or perspective shifts when natural
- Keep the conversation flowing with genuine interest in their experience

Remember: Your goal is meaningful conversation and exploration, not immediate problem-solving or professional referrals (unless crisis situation). Be genuinely curious about their unique experience.`;

        // Chat functionality
        let conversationHistory = [{
            role: 'system',
            content: SYSTEM_PROMPT
        }];

        // Track used responses to prevent repetition
        let usedResponses = {
            suicidal: [], crisis_followup: [], self_harm: [], loneliness: [], general_followup: [],
            depression: [], anxiety: [], bipolar: [], ptsd: [], ocd: [], eating_disorder: [],
            bpd: [], adhd: [], autism: [], schizophrenia: [], panic_disorder: [], social_anxiety: [],
            grief: [], addiction: [], insomnia: [], overwhelmed: [], anger: [], family_issues: [],
            relationship_issues: [], work_stress: [], financial_stress: [], identity_crisis: [],
            low_self_esteem: [], perfectionism: [], guilt_shame: [], motivation: [], sleep_troubles: [],
            greeting: [], general: []
        };

        // Comprehensive Mental Health Response System
        function generateIntelligentResponse(userMessage, conversationHistory = []) {
            const recentMessages = conversationHistory.slice(-4);
            
            const responses = {
                // CRISIS/SUICIDAL IDEATION - ONLY for explicit crisis situations
                suicidal: [
                    "I'm really concerned about what you've shared with me about wanting to end your life. This sounds like you're in serious emotional pain right now. Your safety is the most important thing, and there are people specifically trained to help with these feelings:\n\nâ€¢ US: 988 (Suicide & Crisis Lifeline) - 24/7\nâ€¢ UK: 116 123 (Samaritans) - 24/7\nâ€¢ Crisis Text: HOME to 741741\n\nAre you in immediate danger right now? Can you stay safe while we talk about getting you connected with crisis support?",
                    "What you've shared about suicidal thoughts is really serious, and I'm glad you trusted me with this. When the pain feels so overwhelming that ending your life seems like the only option, that's a sign you need immediate professional support.\n\nâ€¢ Call 988 (US) or 116 123 (UK) right now\nâ€¢ Text HOME to 741741\nâ€¢ Emergency services if you're in immediate danger\n\nCan you tell me - do you have a plan to hurt yourself, or are you safe right now?"
                ],

                // Anxiety - Understanding and exploring
                anxiety: [
                    "I can hear that anxiety is really present for you right now. What does your anxiety typically feel like - is it more physical sensations, racing thoughts, or that constant sense of dread? I'm curious about what kinds of situations or thoughts tend to trigger it most for you. What's been on your mind that's making the anxiety feel particularly present right now?",
                    "When you mention feeling anxious, I wonder what that experience is like for you. Does it come in waves, or is it more of a constant background hum? What thoughts tend to fuel it most? Sometimes exploring what our anxiety is trying to tell us can be helpful - what do you think yours might be worried about?",
                    "Anxiety often has such a physical component too. Where do you feel it most in your body? And what tends to set it off - is it specific situations, certain thoughts, or does it sometimes just appear out of nowhere? I'm interested in understanding your particular relationship with anxiety.",
                    "What's interesting about anxiety is how it can be both completely irrational and feel totally real at the same time. What kinds of 'what if' thoughts does your mind create? Have you noticed any patterns in when it's stronger or quieter? What do you think helps you feel more grounded when it's really intense?"
                ],

                // Depression - Deeper exploration
                depression: [
                    "Depression can feel like such a heavy, persistent presence. When you think about your depression, what does it feel like in your daily life right now? I'm curious - is this a recent struggle, or something you've been dealing with for a while? What made you want to talk about it today?",
                    "You mentioned feeling depressed, and I wonder what that looks like for you specifically. Is it more of a numbness, a heavy sadness, or that exhausting fog that makes everything feel difficult? What time of day tends to be hardest, and have you noticed anything that makes it slightly better or worse?",
                    "Depression affects people so differently. For you, what are the things that feel most impacted? Is it motivation, sleep, relationships, or maybe just that general sense that nothing feels enjoyable anymore? I'm curious about what your experience has been like and what feels most frustrating about it right now."
                ],

                // Overwhelmed - Practical exploration
                overwhelmed: [
                    "When everything feels like too much, it can be hard to even know where to start. What's contributing most to feeling overwhelmed right now - is it work, relationships, life changes, or just an accumulation of daily stresses? Sometimes talking through what's on your plate can help us see patterns or priorities.",
                    "That overwhelmed feeling can be so paralyzing. What does your typical day look like right now? When you think about everything you're dealing with, what feels most urgent versus what might actually be most important? Sometimes those are different things, and sorting that out can help reduce the pressure."
                ],

                // Motivation - Curiosity about what's underneath
                motivation: [
                    "Lack of motivation can be so frustrating, especially when you know what you 'should' be doing but just can't seem to make yourself do it. What's that experience like for you right now? Are there specific things you're struggling to motivate yourself for, or is it more of a general feeling? Sometimes understanding what's underneath can help.",
                    "When motivation feels absent, it's worth exploring what might be going on underneath. Is it that the goals don't feel meaningful anymore, or are you feeling overwhelmed, or maybe burned out? What used to motivate you that doesn't seem to work anymore? Sometimes our motivation systems need recalibrating."
                ],

                // BPD - Exploratory and supportive
                bpd: [
                    "BPD can make emotions feel so incredibly intense - like everything is turned up to maximum volume. When you mentioned borderline, I'm curious about what you're experiencing right now that made you bring it up. Are you in the middle of an emotional storm, or is there something specific about living with BPD that's on your mind today?",
                    "Living with BPD often means your emotional world feels completely different from how others experience things. What's been the most challenging part for you lately? Is it the intensity of feelings, relationship struggles, or maybe that sense of identity shifting? I'd love to understand more about your particular experience with it.",
                    "The emotional intensity of BPD can be both exhausting and overwhelming. What does a typical difficult day look like for you? When these intense emotions hit, what usually triggers them, and how do you typically try to cope? I'm curious about what strategies you've discovered work for you, even if only sometimes."
                ],

                // Loneliness - Compassionate exploration
                loneliness: [
                    "Loneliness can feel so isolating, especially when it seems like everyone else is naturally connected. What does loneliness feel like for you right now? Is it missing specific people, or more about wanting someone who really understands you? I'm curious about what kind of connection you're most longing for.",
                    "When you say you're feeling lonely, I wonder what that looks like in your daily life. Are you physically alone a lot, or is it more that feeling of being surrounded by people but still feeling unseen? What would meaningful connection look like for you - what are you hoping to find in relationships that feels missing right now?",
                    "Loneliness can be such a deep ache. How long have you been feeling this way? What do you think changed or shifted that made the loneliness more noticeable? Sometimes understanding when it started can give us clues about what might help. What kinds of connections have felt most fulfilling for you in the past?"
                ],

                // ADHD - Understanding their experience
                adhd: [
                    "ADHD can make daily life feel like you're operating with a different instruction manual than everyone else. What aspects of ADHD are affecting you most right now? Is it focus issues, time management, emotional regulation, or maybe that sense of being overwhelmed by tasks that seem simple to others? I'd love to understand your particular struggles with it.",
                    "Living with ADHD often means your brain works in unique ways that the world doesn't always accommodate. What feels most frustrating about it lately? And on the flip side, have you noticed any ways that your ADHD brain actually works better than neurotypical brains in certain situations? What are your unique strengths?",
                    "ADHD can affect so many different areas - work, relationships, self-esteem. Where do you feel it's impacting your life most significantly right now? What strategies have you tried, and what's worked even a little bit? Sometimes people with ADHD develop really creative coping mechanisms."
                ],

                // PTSD
                ptsd: [
                    "PTSD can make the world feel unsafe in ways that are hard for others to understand. What's been most challenging for you lately with PTSD? Are you dealing with flashbacks, nightmares, hypervigilance, or maybe just that constant feeling of being on edge? I'm here to listen to whatever feels most present for you right now.",
                    "Living with PTSD often means your nervous system is working overtime to keep you safe, even when you're not in actual danger. What does that feel like in your body and mind day-to-day? What kinds of situations or triggers have you noticed tend to activate your PTSD symptoms most?"
                ],

                // Bipolar
                bipolar: [
                    "Bipolar can feel like living with two completely different people inside you sometimes. Are you currently experiencing a particular phase - maybe depression, mania, hypomania, or somewhere in between? What's that been like for you lately, and how has it been affecting your daily life?",
                    "The mood swings of bipolar can be so disorienting and exhausting. What's your experience been like with the different phases? Do you have warning signs that help you recognize when you're shifting into depression or mania? What feels most challenging about managing bipolar for you right now?"
                ],

                // OCD
                ocd: [
                    "OCD can be such a misunderstood condition - it's so much more than just being 'neat and organized.' What does OCD actually look like in your daily life? Are you dealing more with intrusive thoughts, compulsive behaviors, or both? What feels most exhausting or disruptive about it right now?",
                    "The intrusive thoughts and compulsions of OCD can be incredibly distressing and time-consuming. What kinds of obsessions or compulsions are you struggling with most? How much of your day would you say gets taken up by OCD symptoms? What feels most frustrating about living with this?"
                ],

                // Eating disorders
                eating_disorder: [
                    "Eating disorders involve such a complex relationship with food, body image, and control. What's been most challenging for you lately in your relationship with food and your body? Are you currently getting support from professionals, or is this something you're trying to navigate on your own?",
                    "The thoughts and behaviors around eating disorders can be so consuming and isolating. What does a typical day look like for you right now when it comes to food and body image? What feels most overwhelming or scary about your eating disorder symptoms?"
                ],

                // Autism
                autism: [
                    "Being autistic in a neurotypical world can present so many unique challenges and also strengths. What aspects of being autistic are most on your mind today? Are you dealing with sensory overload, social challenges, changes in routine, or maybe celebrating some of your autistic traits and abilities?",
                    "Autism affects everyone so differently. What does being autistic mean for you personally? What are some of your biggest challenges, and what are some things about being autistic that you actually appreciate or find beneficial? I'm curious about your unique autistic experience."
                ],

                // Panic disorder
                panic_disorder: [
                    "Panic attacks can feel so terrifying and overwhelming when they happen. Are you currently experiencing panic attacks regularly, or is this more about the fear and anxiety around potentially having them? What do panic attacks typically feel like for you - what physical sensations and thoughts come up?",
                    "The fear of having another panic attack can sometimes be almost as distressing as the attacks themselves. What's your experience been like with panic disorder? Do you have certain triggers you've identified, or do they seem to come out of nowhere? What's been most helpful for you when you're in the middle of a panic attack?"
                ],

                // Social anxiety
                social_anxiety: [
                    "Social anxiety can make even simple interactions feel overwhelming and scary. What social situations tend to be most challenging for you? Is it meeting new people, speaking up in groups, being the center of attention, or maybe just the anticipation of social events? What goes through your mind in those moments?",
                    "The physical symptoms of social anxiety can be just as intense as the mental ones. What do you notice happening in your body when you're in anxiety-provoking social situations? How has social anxiety been affecting your relationships, work, or other areas of your life?"
                ],

                // Grief
                grief: [
                    "Grief is such a unique and personal experience. What kind of loss are you processing right now? Whether it's the death of someone close to you, the end of a relationship, a job loss, or any other significant change - grief can show up in so many different ways. What has your grief journey been like so far?",
                    "There's no timeline or 'right way' to grieve, even though sometimes it can feel like there should be. What's grief been like for you day-to-day? Are there particular moments or triggers that make the grief feel especially intense? How are you taking care of yourself through this difficult time?"
                ],

                // Addiction
                addiction: [
                    "Addiction is such a complex struggle that affects every aspect of life. What's your relationship with addiction like right now? Are you currently using, in recovery, or somewhere in between? There's no judgment here - I'm just curious about where you're at and what feels most challenging or important to talk about.",
                    "The cycle of addiction can feel so overwhelming and isolating. What substances or behaviors are you struggling with most? What does a typical day look like for you right now in terms of your addiction? What feels most difficult - the physical aspects, the emotional side, the impact on relationships, or something else entirely?"
                ],

                // Work stress
                work_stress: [
                    "Work stress can really take over your whole life when it gets intense. What's happening at work that's creating the most stress for you right now? Is it your workload, difficult relationships with colleagues or your boss, job insecurity, or maybe feeling unfulfilled in what you're doing?",
                    "When work stress is high, it can affect everything - your sleep, relationships, physical health, and mental wellbeing. What's the stress from work doing to the rest of your life? What would need to change at work for you to feel more balanced and less overwhelmed?"
                ],

                // Relationship issues
                relationship_issues: [
                    "Relationship challenges can be some of the most emotionally draining experiences. What's going on in your relationship that's weighing on you most right now? Is it communication problems, trust issues, growing apart, conflict, or something else entirely? What feels most frustrating or painful about the situation?",
                    "When relationships are struggling, it can affect your whole sense of stability and wellbeing. What's this relationship situation doing to your daily life and emotional state? What do you find yourself hoping for most - resolution, clarity, change, or maybe just someone to understand what you're going through?"
                ],

                // Low self-esteem
                low_self_esteem: [
                    "Low self-esteem can color everything - how you see yourself, how you think others see you, what you believe you deserve. What does low self-esteem sound like in your inner voice? What kinds of thoughts about yourself tend to run through your mind most often throughout the day?",
                    "Self-worth struggles can be so persistent and convincing, even when logically you know the harsh thoughts aren't completely true. Where do you think your low self-esteem comes from? Are there particular areas where you're hardest on yourself - your appearance, abilities, relationships, achievements?"
                ],

                // Anger
                anger: [
                    "Anger can be such a powerful and sometimes overwhelming emotion. What's been triggering your anger lately? Is it frustration with specific situations, people, injustices, or maybe anger that seems to come from deeper pain or hurt? What does anger feel like in your body when it shows up?",
                    "Sometimes anger is the emotion we feel on the surface, but there might be other feelings underneath - like hurt, disappointment, fear, or feeling powerless. What do you think might be fueling your anger? How has it been affecting your relationships and daily life?"
                ],

                // General - Encouraging exploration
                general: [
                    "I can sense there's something on your mind that you're trying to process. What's been weighing on you lately? Sometimes just putting words to our feelings can help us understand them better. What would it feel like to share what's really going on underneath the surface?",
                    "Thank you for trusting me with whatever you're carrying. I'm genuinely curious about your experience - what's been most on your mind recently? What feels most important or pressing to talk through? Sometimes we need to explore our feelings before we can figure out what we need.",
                    "I appreciate you reaching out and being willing to share. What's your inner world like right now? What thoughts or feelings have been taking up the most space in your mind? I'm here to listen and help you explore whatever you're experiencing, without any pressure to have it all figured out.",
                    "It takes courage to start a conversation about how you're really doing. What made you want to talk today? What's been happening in your life that feels important to process or understand better? I'm genuinely interested in hearing about your unique experience and perspective.",
                    "I hear you reaching out, and I want you to know that whatever you're experiencing matters. What's been most challenging or confusing for you lately? Sometimes talking through our thoughts and feelings with someone can help us see things more clearly. What feels most important to explore right now?"
                ],

                // Greeting - Warm and curious
                greeting: [
                    "Hello! I'm really glad you're here. This is your space to share whatever's truly on your mind. What brought you here today? Whether it's something specific weighing on you or you're just feeling a bit off and not sure why, I'm here to listen and explore it with you.",
                    "Hi there! Thank you for reaching out. I'm curious about what's happening in your world right now. What's been occupying your thoughts lately, or what made you want to talk to someone today? Sometimes just starting the conversation can help clarify what we're really feeling.",
                    "Welcome! I'm here to provide a space where you can be completely honest about how you're doing. What would feel most helpful to talk about right now? Whether it's something specific or just a general sense that something feels off, I'm genuinely interested in understanding your experience.",
                    "Hello! I'm really happy you decided to reach out. What's on your heart or mind today? Sometimes we know exactly what we want to talk about, and sometimes we just know we need to talk. Either way is completely fine - what feels most present for you right now?"
                ]
            };

            const lowerMessage = userMessage.toLowerCase();
            let responseCategory = 'general';
            
            // Detection logic
            if (lowerMessage.includes('suicidal') || lowerMessage.includes('kill myself') || lowerMessage.includes('want to die') || lowerMessage.includes('end my life') || lowerMessage.includes('suicide') || lowerMessage.includes('self harm') || lowerMessage.includes('hurt myself')) {
                responseCategory = 'suicidal';
            }
            else if (lowerMessage.includes('bpd') || lowerMessage.includes('borderline')) {
                responseCategory = 'bpd';
            }
            else if (lowerMessage.includes('lonely') || lowerMessage.includes('loneliness') || lowerMessage.includes('alone') || lowerMessage.includes('isolated')) {
                responseCategory = 'loneliness';
            }
            else if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('worried') || lowerMessage.includes('panic')) {
                responseCategory = 'anxiety';
            }
            else if (lowerMessage.includes('depressed') || lowerMessage.includes('depression') || lowerMessage.includes('sad') || lowerMessage.includes('hopeless')) {
                responseCategory = 'depression';
            }
            else if (lowerMessage.includes('adhd') || lowerMessage.includes('add') || lowerMessage.includes('attention deficit')) {
                responseCategory = 'adhd';
            }
            else if (lowerMessage.includes('ptsd') || lowerMessage.includes('trauma') || lowerMessage.includes('flashback')) {
                responseCategory = 'ptsd';
            }
            else if (lowerMessage.includes('bipolar') || lowerMessage.includes('manic') || lowerMessage.includes('mania')) {
                responseCategory = 'bipolar';
            }
            else if (lowerMessage.includes('ocd') || lowerMessage.includes('obsessive') || lowerMessage.includes('compulsive')) {
                responseCategory = 'ocd';
            }
            else if (lowerMessage.includes('eating disorder') || lowerMessage.includes('anorexia') || lowerMessage.includes('bulimia') || lowerMessage.includes('binge eating')) {
                responseCategory = 'eating_disorder';
            }
            else if (lowerMessage.includes('autism') || lowerMessage.includes('autistic') || lowerMessage.includes('asperger')) {
                responseCategory = 'autism';
            }
            else if (lowerMessage.includes('panic disorder') || lowerMessage.includes('panic attack')) {
                responseCategory = 'panic_disorder';
            }
            else if (lowerMessage.includes('social anxiety') || lowerMessage.includes('social phobia')) {
                responseCategory = 'social_anxiety';
            }
            else if (lowerMessage.includes('grief') || lowerMessage.includes('grieving') || lowerMessage.includes('loss') || lowerMessage.includes('death')) {
                responseCategory = 'grief';
            }
            else if (lowerMessage.includes('addiction') || lowerMessage.includes('addicted') || lowerMessage.includes('substance') || lowerMessage.includes('drinking') || lowerMessage.includes('drugs')) {
                responseCategory = 'addiction';
            }
            else if (lowerMessage.includes('work stress') || lowerMessage.includes('job stress') || lowerMessage.includes('workplace')) {
                responseCategory = 'work_stress';
            }
            else if (lowerMessage.includes('relationship') || lowerMessage.includes('boyfriend') || lowerMessage.includes('girlfriend') || lowerMessage.includes('partner') || lowerMessage.includes('marriage')) {
                responseCategory = 'relationship_issues';
            }
            else if (lowerMessage.includes('self esteem') || lowerMessage.includes('self-esteem') || lowerMessage.includes('self worth') || lowerMessage.includes('confidence')) {
                responseCategory = 'low_self_esteem';
            }
            else if (lowerMessage.includes('angry') || lowerMessage.includes('anger') || lowerMessage.includes('furious') || lowerMessage.includes('rage')) {
                responseCategory = 'anger';
            }
            else if (lowerMessage.includes('overwhelmed') || lowerMessage.includes('too much') || lowerMessage.includes('burnout')) {
                responseCategory = 'overwhelmed';
            }
            else if (lowerMessage.includes('motivation') || lowerMessage.includes('need motivation') || lowerMessage.includes('unmotivated')) {
                responseCategory = 'motivation';
            }
            else if (lowerMessage.includes('sleep') || lowerMessage.includes('insomnia') || lowerMessage.includes('can\'t sleep') || lowerMessage.includes('sleep troubles')) {
                responseCategory = 'sleep_troubles';
            }
            else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                responseCategory = 'greeting';
            }
            
            // Get response from category, avoiding repetition
            const categoryResponses = responses[responseCategory] || responses['general'];
            const usedCategoryResponses = usedResponses[responseCategory] || [];
            
            // Find unused responses
            const unusedResponses = categoryResponses.filter(response => 
                !usedCategoryResponses.includes(response)
            );
            
            let selectedResponse;
            if (unusedResponses.length > 0) {
                selectedResponse = unusedResponses[Math.floor(Math.random() * unusedResponses.length)];
            } else {
                // All responses used, reset and pick one
                usedResponses[responseCategory] = [];
                selectedResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            }
            
            // Track this response as used
            if (!usedResponses[responseCategory]) {
                usedResponses[responseCategory] = [];
            }
            usedResponses[responseCategory].push(selectedResponse);
            
            return { choices: [{ message: { content: selectedResponse } }] };
        }

        // ChatGPT API call function with fallback
        async function callChatGPT(messages) {
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${OPENAI_API_KEY}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: "gpt-4",
                        messages: messages,
                        temperature: 0.75,
                        top_p: 0.9,
                        max_tokens: 800,
                        frequency_penalty: 0.3,
                        presence_penalty: 0.1,
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('OpenAI API Error:', error);
                // Fall back to intelligent response system
                const lastUserMessage = messages[messages.length - 1].content;
                return generateIntelligentResponse(lastUserMessage, messages);
            }
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Disable send button and input
            sendButton.disabled = true;
            input.disabled = true;
            
            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Add user message to conversation history
                conversationHistory.push({
                    role: 'user',
                    content: message
                });

                // Call ChatGPT API with intelligent fallback
                const data = await callChatGPT(conversationHistory);
                const aiResponse = data.choices[0].message.content.trim();
                
                // Add AI response to conversation history
                conversationHistory.push({
                    role: 'assistant',
                    content: aiResponse
                });

                // Keep conversation history manageable
                if (conversationHistory.length > 21) {
                    conversationHistory = [
                        conversationHistory[0], // Keep system prompt
                        ...conversationHistory.slice(-20) // Keep last 20 messages
                    ];
                }

                hideTypingIndicator();
                addMessage(aiResponse, 'ai');

            } catch (error) {
                hideTypingIndicator();
                console.error('Error:', error);
                
                // Fallback to intelligent response
                const fallbackResponse = generateIntelligentResponse(message, conversationHistory);
                addMessage(fallbackResponse.choices[0].message.content, 'ai');
            } finally {
                // Re-enable send button and input
                sendButton.disabled = false;
                input.disabled = false;
                input.focus();
            }
        }

        function addMessage(content, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            if (sender === 'ai') {
                // Create AI message with avatar
                messageDiv.innerHTML = `
                    <img src="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/Eden.png" alt="Eden Avatar" class="ai-avatar">
                    <div class="ai-message-content">${content}</div>
                `;
            } else {
                // Regular user message
                messageDiv.textContent = content;
            }
            
            // Remove welcome section after first user message
            if (sender === 'user') {
                const welcomeSection = document.querySelector('.welcome-section');
                if (welcomeSection) {
                    welcomeSection.remove();
                }
            }
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            // Remove any existing typing indicator first
            hideTypingIndicator();
            
            // Create a new typing indicator
            const chatArea = document.getElementById('chatArea');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message';
            typingDiv.id = 'currentTypingIndicator';
            typingDiv.innerHTML = `
                <img src="https://raw.githubusercontent.com/ChurchandLee/ubiquitous-guacamole/main/Eden.png" alt="Eden Avatar" class="ai-avatar">
                <div class="thinking-heart">ðŸ’š</div>
            `;
            
            chatArea.appendChild(typingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTypingIndicator() {
            const existingIndicator = document.getElementById('currentTypingIndicator');
            if (existingIndicator) {
                existingIndicator.remove();
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('messageInput').focus();
        });
    </script>
</body>
</html>
